<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Monitoring Temuan</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
    <link rel="icon" href="{{ url_for('static', filename='favicon-32x32.png') }}" type="image/png"/>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <style>
        :root {
            --primary-color: #C62828;
            --primary-hover: #B71C1C;
            --primary-light: #FFEBEE;
            --active-bg: #E3F2FD;
            --active-text: #1565C0;
            --secondary-bg: #F4F7FE;
            --sidebar-width: 290px;
            --sidebar-collapsed-width: 85px;
            --text-dark: #2B3674;
            --text-gray: #A3AED0;
            --text-light-gray: #707EAE;
            --white: #FFFFFF;
            --border-color: #E0E5F2;
            --secondary-color: green;
            --text-color: #333;
            --bg-light: #f8f9fa;
            --danger: #dc3545;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0; padding: 0; font-family: 'DM Sans', sans-serif;
            background-color: var(--secondary-bg); display: block; 
            min-height: 100vh; color: var(--text-color); font-size: 0.9rem;
        }

        .sidebar {
            width: var(--sidebar-width); background: var(--white); height: 100vh;
            position: fixed; left: 0; top: 0; display: flex; flex-direction: column;
            padding: 24px; box-sizing: border-box; border-right: 1px solid var(--border-color);
            z-index: 3000; overflow-y: auto; scrollbar-width: thin; scrollbar-color: #ddd transparent;
            transition: width 0.3s ease, padding 0.3s ease;
        }

        .sidebar.collapsed { width: var(--sidebar-collapsed-width); padding: 24px 12px; }
        .sidebar::-webkit-scrollbar { width: 6px; }
        .sidebar::-webkit-scrollbar-thumb { background-color: #ddd; border-radius: 3px; }

        .sidebar-toggle-btn {
            position: absolute; top: 25px; right: 20px; cursor: pointer;
            font-size: 24px; color: var(--text-gray); z-index: 3002; transition: right 0.3s ease;
        }
        .sidebar.collapsed .sidebar-toggle-btn { right: 50%; transform: translateX(50%); }

        .sidebar-logo {
            display: flex; align-items: center; justify-content: center;
            margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid var(--border-color);
            min-height: 50px; position: relative;
        }
        .sidebar-logo img { max-width: 100px; height: auto; transition: opacity 0.2s; }
        .sidebar.collapsed .sidebar-logo img { opacity: 0; pointer-events: none; display: none; }

        .nav-links { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 8px; flex: 1; }
        .nav-links li { width: 100%; }

        .nav-section-label {
            font-size: 11px; font-weight: 700; color: var(--text-gray);
            text-transform: uppercase; letter-spacing: 0.8px; margin-top: 16px; margin-bottom: 8px;
            padding-left: 12px; display: block; white-space: nowrap; transition: opacity 0.2s;
        }
        .sidebar.collapsed .nav-section-label { display: none; }

        .nav-links a {
            text-decoration: none; color: var(--text-light-gray); font-weight: 500; font-size: 14px;
            display: flex; align-items: center; padding: 12px 16px; border-radius: 12px;
            transition: all 0.2s ease; position: relative; white-space: nowrap; overflow: hidden;
        }
        .nav-links a i {
            font-size: 22px; margin-right: 14px; color: var(--text-gray);
            transition: margin 0.3s ease, color 0.2s; min-width: 22px;
        }
        .sidebar.collapsed .nav-links a { justify-content: center; padding: 12px; }
        .sidebar.collapsed .nav-links a i { margin-right: 0; }
        .sidebar.collapsed .nav-links a span { display: none; }

        .nav-links a:hover { background-color: var(--secondary-bg); color: var(--text-dark); }
        .nav-links a:hover i { color: var(--primary-color); }
        .nav-links a.active { background-color: var(--active-bg); color: var(--active-text); font-weight: 700; }
        .nav-links a.active i { color: var(--active-text); }

        .sidebar-footer { margin-top: 20px; }
        .user-card {
            background: linear-gradient(135deg, #C62828 0%, #B71C1C 100%);
            padding: 16px; border-radius: 16px; color: white; display: flex;
            flex-direction: column; gap: 10px; box-shadow: 0 10px 20px rgba(198, 40, 40, 0.2);
            transition: padding 0.3s; overflow: hidden;
        }
        .sidebar.collapsed .user-card { padding: 12px; align-items: center; background: var(--primary-color); }
        
        .user-info { display: flex; align-items: center; gap: 12px; }
        .sidebar.collapsed .user-info { gap: 0; justify-content: center; }
        
        .user-avatar {
            width: 36px; height: 36px; background: rgba(255,255,255,0.2);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 18px; flex-shrink: 0;
        }
        .user-details { display: flex; flex-direction: column; white-space: nowrap; }
        .sidebar.collapsed .user-details { display: none; }
        .user-name { font-size: 14px; font-weight: 700; }
        .user-role { font-size: 11px; opacity: 0.8; }

        .logout-link {
            background: rgba(255,255,255,0.1); color: white; text-decoration: none;
            padding: 8px; border-radius: 8px; font-size: 12px; text-align: center;
            font-weight: 600; transition: background 0.2s; display: flex; align-items: center;
            justify-content: center; gap: 6px;
        }
        .sidebar.collapsed .logout-link span { display: none; }
        .sidebar.collapsed .logout-link { padding: 8px 0; margin-top: 5px; }
        .logout-link:hover { background: rgba(255,255,255,0.2); }

        main, .monitoring-main {
            margin-left: var(--sidebar-width) !important; width: auto !important; max-width: 100%;
            padding: 30px; box-sizing: border-box; min-height: 100vh; display: flex;
            flex-direction: column; transition: margin-left 0.3s ease;
        }
        main.expanded, .monitoring-main.expanded { margin-left: var(--sidebar-collapsed-width) !important; }

        footer {
            margin-top: auto; background-color: var(--secondary-bg); padding: 10px 0;
            text-align: center; color: #999; font-size: 0.75rem; width: 100%; box-sizing: border-box;
        }

        .hidden { display: none !important; }
        .start-btn {
            background-color: var(--primary-color); color: white; padding: 10px 20px;
            border-radius: 8px; border: none; cursor: pointer; font-weight: 600; transition: background-color 0.3s;
        }
        .start-btn:hover { background-color: var(--primary-hover); }

        .temuan-table-wrapper {
            overflow-x: auto; max-width: 100%; border: 1px solid #e0e0e0; border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05); background: white; margin-bottom: 20px;
        }
        .temuan-table { width: 100%; border-collapse: separate; border-spacing: 0; font-size: 0.9rem; }
        .temuan-table th, .temuan-table td { border-bottom: 1px solid #ddd; border-right: 1px solid #ddd; padding: 12px 15px; vertical-align: middle !important; line-height: 1.5; }
        .temuan-table th { background-color: #f8f9fa; position: sticky; top: 0; z-index: 10; font-weight: 700; text-align: center; color: #444; box-shadow: 0 1px 1px rgba(0,0,0,0.1); }

        .th-identitas { background-color: #e3f2fd !important; color: #0d47a1; }
        .th-rencana { background-color: #fff3e0 !important; color: #e65100; }
        .th-status { background-color: #e8f5e9 !important; color: #1b5e20; }
        .th-bpk { background-color: #ffebee !important; color: #b71c1c; }

        .temuan-table th:last-child, .temuan-table td:last-child {
            position: sticky; right: 0; border-left: 2px solid #e0e0e0; box-shadow: -2px 0 5px rgba(0,0,0,0.05);
        }
        .temuan-table th:last-child { z-index: 12; background-color: #f8f9fa; }
        .temuan-table td:last-child { z-index: 11; background-color: #fff; }

        .col-narrow { min-width: 80px; max-width: 100px; text-align: center; }
        .col-medium { min-width: 150px; max-width: 200px; text-align: center; }
        .col-wide { min-width: 350px; max-width: 600px; text-align: left; white-space: pre-wrap; }
        .col-history { min-width: 350px; max-width: 500px; vertical-align: top !important; background-color: #f3e5f5; padding: 5px !important; }
        
        .history-mini-table { width: 100%; border-collapse: collapse; font-size: 0.75rem; background-color: rgba(255, 255, 255, 0.8); border-radius: 4px; overflow: hidden; }
        .history-mini-table thead th { background-color: greenyellow !important; color: black; font-weight: 600; padding: 4px 6px; text-align: center; border: none; position: static !important; z-index: auto !important;}
        .history-mini-table tbody td { border-bottom: 1px solid #e1bee7; padding: 4px 6px; color: #333; vertical-align: top !important; }

        .text-center { text-align: center !important; }
        .text-left { text-align: left !important; }
        
        .status-bjt { color: #0d47a1; background-color: #e3f2fd; padding: 4px 10px; border-radius: 20px; font-weight: 600; font-size: 0.85em; border: 1px solid #bbdefb; display: inline-block; }
        .status-os { color: #721c24; background-color: #f8d7da; padding: 4px 10px; border-radius: 20px; font-weight: 600; font-size: 0.85em; border: 1px solid #f5c6cb; display: inline-block; }
        .status-selesai { color: #004085; background-color: #cce5ff; padding: 4px 10px; border-radius: 20px; font-weight: 600; font-size: 0.85em; border: 1px solid #b8daff; display: inline-block; }

        .comment-list { display: flex; flex-direction: column; gap: 8px; }
        .btn-delete-comment { position: absolute; top: 2px; right: 5px; background: none; border: none; color: #aaa; cursor: pointer; font-size: 16px; }
        .btn-delete-comment:hover { color: #d32f2f; }
        .btn-add-note-modern { display: flex; align-items: center; justify-content: center; width: 100%; padding: 6px; background: #f9f9f9; color: #666; border: 1px dashed #ccc; border-radius: 6px; cursor: pointer; font-size: 0.8rem; font-weight: 600; }
        .btn-add-note-modern:hover { background: #e3f2fd; border-color: #2196f3; color: #1976d2; }
        
        .modal { z-index: 3005; }
        .box-layout-modal { width: 600px !important; max-width: 95vw; padding: 2.5rem !important; border-radius: 12px; max-height: 85vh; overflow-y: auto; }
        .form-grid-wrapper { display: flex; flex-direction: column; gap: 8px; margin-bottom: 10px; }
        .form-group { margin-bottom: 0; }
        .form-group label { display: block; margin-bottom: 6px; font-weight: 600; color: var(--text-color); font-size: 0.9rem; }
        .form-group input[type="text"], .form-group input[type="number"], .form-group input[type="date"], .form-group select, .custom-select {
            width: 100%; height: 42px !important; padding: 0 12px; border: 1px solid #ccc; border-radius: 6px; font-family: 'Poppins', sans-serif; font-size: 0.9rem; color: #333; box-sizing: border-box; display: block; background-color: white; outline: none;
        }
        .form-group textarea { width: 100%; padding: 10px 12px; border: 1px solid #ccc; border-radius: 6px; font-family: 'Poppins', sans-serif; font-size: 0.9rem; box-sizing: border-box; }
        .modal-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 10px; }
        .cancel-btn { background: #fff; border: 1px solid #ccc; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 600; color: #555; }
        .login-btn { background: var(--primary-color); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 600; }
        
        .search-popup-list { list-style: none; padding: 0; margin: 0; max-height: 400px; overflow-y: auto; border: 1px solid #eee; border-radius: 6px; }
        .search-popup-list li { padding: 12px; border-bottom: 1px solid #f5f5f5; cursor: pointer; transition: background 0.2s; }
        .search-popup-list li:hover { background-color: #e3f2fd; }
        
        .pic-input-wrapper {
            display: flex; align-items: center; gap: 10px;
        }
        .pic-display-box {
            flex: 1; min-height: 42px; border: 1px solid #ccc; border-radius: 6px; padding: 8px 12px;
            background-color: #fcfcfc; font-size: 0.9rem; color: #555; display: flex; align-items: center;
            overflow: hidden; white-space: nowrap; text-overflow: ellipsis;
        }
        .btn-pilih-pic {
            background-color: #1976D2; color: white; border: none; border-radius: 6px; padding: 0 15px; height: 42px;
            cursor: pointer; font-weight: 600; font-size: 0.85rem; transition: background 0.2s; white-space: nowrap;
        }
        .btn-pilih-pic:hover { background-color: #1565C0; }

        .pic-table {
            width: 100%; border-collapse: collapse; margin-top: 10px;
        }
        .pic-table th, .pic-table td {
            padding: 10px 15px; border-bottom: 1px solid #eee; text-align: left;
        }
        .pic-table th {
            background-color: #f9f9f9; font-weight: 600; color: #555; position: sticky; top: 0; z-index: 5;
        }
        .pic-table tr:last-child td { border-bottom: none; }
        .pic-table tr:hover { background-color: #f0f7ff; }
        .pic-table input[type="checkbox"] {
            width: 16px; height: 16px; cursor: pointer;
        }
        
        .sortable { cursor: pointer; position: relative; }
        .sortable:hover { background-color: #f1f1f1; }
        .sort-icon { margin-left: 5px; font-size: 0.8em; color: #999; }
        
        .btn-delete-floating { position: absolute; top: 2px; right: 2px; background: none; border: none; color: #ef5350; cursor: pointer; font-size: 1.2em; font-weight: bold; padding: 0 4px; border-radius: 4px; opacity: 0.6; }
        .btn-delete-floating:hover { color: #c62828; background-color: #ffebee; opacity: 1; }

        .report-table { width: 100%; border-collapse: collapse; font-family: Arial, sans-serif; font-size: 12px; color: black; border: 1px solid black; }
        .report-table th, .report-table td { border: 1px solid black; padding: 6px 10px; vertical-align: middle; }
        .report-table thead th, .report-table tfoot th, .report-table tfoot td { background-color: #C00000; color: white; font-weight: bold; text-align: center; }
        .no-transition { transition: none !important; }

        .choose-data-btn {
            background: linear-gradient(135deg, #1e88e5 0%, #1565c0 100%);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 15px rgba(21, 101, 192, 0.3);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .choose-data-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(21, 101, 192, 0.4);
        }

        .choose-data-btn i {
            font-size: 20px;
        }

        .selection-modal-content {
            background: #fff;
            padding: 30px;
            border-radius: 20px;
            width: 100%;
            max-width: 450px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.1);
            text-align: center;
        }

        .selection-modal-header {
            margin-bottom: 25px;
        }

        .selection-modal-header h2 {
            color: var(--text-dark);
            margin: 0;
            font-size: 24px;
        }

        .selection-modal-header p {
            color: var(--text-gray);
            margin: 5px 0 0;
            font-size: 14px;
        }

        .styled-select-container {
            margin-bottom: 20px;
            text-align: left;
        }

        .styled-select-label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-dark);
            font-weight: 600;
            font-size: 14px;
        }

        .styled-select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e5f2;
            border-radius: 10px;
            font-size: 14px;
            color: var(--text-dark);
            background-color: #fff;
            transition: border-color 0.3s;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23007CB2%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
            background-repeat: no-repeat;
            background-position: right 15px top 50%;
            background-size: 12px auto;
        }

        .styled-select:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .styled-select:disabled {
            background-color: #f4f7fe;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .action-btn-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn-cancel {
            flex: 1;
            padding: 12px;
            border-radius: 10px;
            border: none;
            background: #f4f7fe;
            color: var(--text-light-gray);
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        .btn-cancel:hover {
            background: #e0e5f2;
            color: var(--text-dark);
        }

        .btn-confirm {
            flex: 1;
            padding: 12px;
            border-radius: 10px;
            border: none;
            background: var(--primary-color);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        .btn-confirm:hover {
            background: var(--primary-hover);
        }
        
        .selection-info-badge {
            background-color: #43A047; 
            color: white; 
            padding: 8px 16px; 
            border-radius: 8px; 
            font-size: 14px; 
            font-weight: 600; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
    </style>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const sidebar = document.querySelector('.sidebar');
            const main = document.querySelector('main');
            const toggleBtn = document.querySelector('.sidebar-toggle-btn i');
            const isCollapsed = localStorage.getItem('sidebar-collapsed') === 'true';

            if (isCollapsed) {
                sidebar.classList.add('no-transition');
                main.classList.add('no-transition');
                sidebar.classList.add('collapsed');
                main.classList.add('expanded');
                if(toggleBtn) toggleBtn.className = 'bx bx-right-arrow-alt';
                setTimeout(() => {
                    sidebar.classList.remove('no-transition');
                    main.classList.remove('no-transition');
                }, 100); 
            }
        });

        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const main = document.querySelector('main');
            const toggleBtn = document.querySelector('.sidebar-toggle-btn i');
            sidebar.classList.toggle('collapsed');
            main.classList.toggle('expanded');
            const isCollapsed = sidebar.classList.contains('collapsed');
            localStorage.setItem('sidebar-collapsed', isCollapsed);
            
            if (isCollapsed) {
                toggleBtn.className = 'bx bx-right-arrow-alt';
            } else {
                toggleBtn.className = 'bx bx-menu';
            }
        }
    </script>
</head>
<body data-user-id="{{ current_user_id }}">

    <input type="hidden" id="current-username" value="{{ current_user.fullname }}">

    <nav class="sidebar">
        <div class="sidebar-toggle-btn" onclick="toggleSidebar()">
            <i class='bx bx-menu'></i>
        </div>
        <div class="sidebar-logo">
            <a href="{{ url_for('dashboard') }}">
                <img src="{{ url_for('static', filename='Logo_IFG-removebg-preview.png') }}" alt="Logo IFG">
            </a>
        </div>
        <ul class="nav-links">
            <li><a href="{{ url_for('dashboard') }}"><i class='bx bxs-home-alt-2'></i><span>Dashboard</span></a></li>
            <span class="nav-section-label">Analisis Dokumen</span>
            <li><a href="{{ url_for('dashboard') }}#folder-management"><i class='bx bxs-folder'></i><span>Folder Saya</span></a></li>
            <li><a href="{{ url_for('dashboard') }}#fitur"><i class='bx bxs-magic-wand'></i><span>Proofread & Tools</span></a></li>
            <li><a href="{{ url_for('log_analysis_page') }}"><i class='bx bxs-time-five'></i><span>Log Analisis</span></a></li>
            <span class="nav-section-label">Tindak Lanjut</span>
            <li><a href="{{ url_for('monitoring_ams_page') }}"><i class='bx bxs-bar-chart-alt-2'></i><span>Rekap Monitoring</span></a></li>
            <li><a href="{{ url_for('ams_temuan_page') }}" class="active"><i class='bx bxs-file-find'></i><span>Temuan</span></a></li>
            <li><a href="{{ url_for('ams_reminder_page') }}"><i class='bx bxs-bell-ring'></i><span>Reminder</span></a></li>
            <li><a href="{{ url_for('ams_tl_tidak_setuju_page') }}"><i class='bx bxs-x-circle'></i><span>TL Tidak Setuju</span></a></li>
            <li><a href="{{ url_for('ams_auditors_page') }}"><i class='bx bxs-user-badge'></i><span>Auditors</span></a></li>
            <span class="nav-section-label">Lainnya</span>
            <li><a href="{{ url_for('mailbox_page') }}"><i class='bx bxs-envelope'></i><span>Email</span></a></li>
            <li><a href="{{ url_for('library_page') }}"><i class='bx bxs-book-bookmark'></i><span>Library</span></a></li>
            <li><a href="{{ url_for('settings_page') }}"><i class='bx bxs-cog'></i><span>Settings</span></a></li>
        </ul>
        <div class="sidebar-footer">
            <div class="user-card">
                <div class="user-info">
                    <div class="user-avatar"><i class='bx bxs-user'></i></div>
                    <div class="user-details"><span class="user-name">{{ current_user.fullname }}</span><span class="user-role">{{ current_user.label }}</span></div>
                </div>
                <a href="{{ url_for('logout') }}" class="logout-link"><i class='bx bx-log-out'></i> <span>Logout</span></a>
            </div>
        </div>
    </nav>

    <main class="monitoring-main">
        <section class="monitoring-header">
            <h1>Daftar Temuan Audit</h1>
            <button id="add-temuan-session-btn" class="start-btn">Buat Sesi Temuan Baru</button>
        </section>

        <section class="filter-section" style="margin-bottom: 1rem;">
            <div class="multi-select-container" style="display: flex; align-items: center; gap: 1rem;">
                <button id="choose-data-btn" class="choose-data-btn">
                    <i class='bx bxs-layer'></i> Choose Data Sesi
                </button>
                <div id="selection-info-display" class="selection-info-badge hidden">
                    <i class='bx bxs-check-circle'></i>
                    <span id="selection-info-text"></span>
                </div>
                <button id="delete-session-btn" class="analyze-btn" style="height: 42px; background-color: var(--danger); display: none;">Hapus Sesi</button>
            </div>
        </section>

        <section id="search-filter-container" class="hidden" style="background: #fff; padding: 20px; border-radius: 8px; border: 1px solid #e0e0e0; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
            <div style="display: flex; gap: 30px; align-items: flex-end;">
                <div style="flex: 0 0 250px;">
                    <label style="display: block; font-weight: bold; margin-bottom: 8px; color: #333; position: relative; top: 10px;">Filter by:</label>
                    <select id="filter-column-select" style="width: 100%; padding: 0 12px; border-radius: 6px; border: 1px solid #ccc; height:42px; box-sizing: border-box;">
                        <option value="all">Semua Kolom</option>
                        <option value="no_aoi">No AOI</option>
                        <option value="pic_skai">PIC SKAI</option> 
                        <option value="jenis_aoi">Jenis AOI</option>
                        <option value="klasifikasi">Klasifikasi</option>
                        <option value="auditee">Auditee</option>
                        <option value="pic_auditee">PIC Auditee</option>
                    </select>
                </div>
                <div style="flex: 0 0 250px;"> 
                    <label style="display: block; font-weight: bold; margin-bottom: 8px; color: #333;">Advanced Search:</label>
                    <div style="position: relative; width: 100%;">
                        <input type="text" id="advanced-search-display" readonly placeholder="Pilih Unique Values" style="width: 100%; padding: 0 12px; border-radius: 6px; border: 1px solid #ccc; height:42px; line-height: 40px; box-sizing: border-box; cursor: pointer; background-color: white; text-overflow: ellipsis; overflow: hidden; white-space: nowrap;">
                        <input type="hidden" id="advanced-search-value"> 
                    </div>
                </div>
            </div>
        </section>

        <section id="temuan-container" class="data-table-container hidden">
            <div class="list-header" style="margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center;">
                <h3 id="table-title" style="margin: 0;">Detail Temuan</h3>  
                <div style="display: flex; gap: 10px;">
                    <button id="monthly-report-btn" class="analyze-btn" style="background-color: #d32f2f; color: white;">Laporan Bulanan</button>
                    <button id="share-session-btn" class="analyze-btn" style="background-color: #f57c00; color: white;">Share</button>            
                    <button id="open-new-page-btn" class="analyze-btn" style="background-color: #5C6BC0; color: white;" onclick="openSessionInNewPage()">Buka di halaman baru</button>
                    <input type="file" id="excel-import-input" accept=".xlsx, .xls" style="display: none;" />
                    <button id="import-excel-btn" class="analyze-btn" style="background-color: #00897b;">Import Excel</button>
                    <button id="add-row-btn" class="analyze-btn">Tambah Baris Data</button>
                </div>
            </div>

            <div class="temuan-table-wrapper">
                <table class="temuan-table" id="main-temuan-table">
                    <thead>
                        <tr>
                            <th class="th-identitas col-narrow">No AOI</th>
                            <th class="th-identitas col-medium">PIC SKAI</th>
                            <th class="th-identitas col-narrow">Jenis AOI</th>
                            <th class="th-identitas col-medium">Klasifikasi</th>
                            <th class="th-identitas col-medium">No LHA</th>
                            <th class="th-identitas col-medium">Nama Penugasan</th>
                            <th class="th-identitas col-wide">Area of Improvement (AOI)</th>
                            <th class="th-identitas col-wide">Rekomendasi</th>
                            <th class="th-rencana col-wide">Rencana Tindak Lanjut</th>
                            <th class="th-rencana col-wide">Rencana Evidence</th>
                            <th class="th-rencana col-medium">Auditee</th>
                            <th class="th-rencana col-medium">PIC Auditee</th>
                            <th class="th-rencana col-medium">Target Penyelesaian</th>
                            <th class="th-rencana col-medium">Perubahan Target</th>
                            <th class="th-status col-wide">Tindak Lanjut</th>
                            <th class="th-status col-medium">Signifikansi</th>
                            <th class="th-status col-medium" id="header-status-prev">Status Akhir (Bulan Lalu)</th>
                            <th class="th-status col-medium" id="header-status-curr">Status Akhir (Bulan Ini)</th>
                            <th class="th-status col-narrow">Jml Rekomendasi</th>
                            <th class="th-status col-narrow">Selesai</th>
                            <th class="th-bpk col-narrow">Belum JT / BS (BPK)</th>
                            <th class="th-bpk col-narrow">OS / BD (BPK)</th>
                            <th class="th-bpk col-narrow">TDD (BPK)</th>
                            <th class="th-identitas col-medium">Control</th>
                            <th class="th-identitas col-wide" style="background-color: #fff8e1 !important;">Catatan Auditor</th>
                            <th class="col-history" style="background-color: #f3e5f5 !important; color: #4a148c;">History Modified</th>
                            <th class="col-medium">Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="temuan-tbody"></tbody>
                </table>
            </div>
            
            <div style="margin-top: 1rem; text-align: right;">
                <button onclick="exportTableToExcel('main-temuan-table', 'Data_Temuan')" class="analyze-btn" style="background-color: #217346;">Export Excel</button>
            </div>
        </section>

        <footer>
            <p>2025 Dashboard CoE | Departemen Center of Excellence, Satuan Kerja Audit Internal | Indonesia Financial Group</p>
        </footer>
    </main>

    <div id="selection-modal" class="modal hidden" style="display: flex; align-items: center; justify-content: center; z-index: 3100;">
        <div class="selection-modal-content">
            <div class="selection-modal-header">
                <h2>Pilih Data Sesi</h2>
                <p>Silakan pilih jenis audit dan nama sesi</p>
            </div>
            
            <div class="styled-select-container">
                <label class="styled-select-label">Jenis Audit</label>
                <select id="modal-audit-type" class="styled-select">
                    <option value="" disabled selected>-- Pilih Jenis Audit --</option>
                </select>
            </div>

            <div class="styled-select-container">
                <label class="styled-select-label">Nama Sesi</label>
                <select id="modal-session-name" class="styled-select" disabled>
                    <option value="" disabled selected>-- Pilih Sesi --</option>
                </select>
            </div>

            <div class="action-btn-group">
                <button id="modal-close-btn" class="btn-cancel">Batal</button>
                <button id="modal-submit-btn" class="btn-confirm">Tampilkan</button>
            </div>
        </div>
    </div>

    <div id="filter-value-modal" class="modal hidden" style="z-index: 2500;">
        <div class="modal-content" style="max-width: 500px; height: 600px; display: flex; flex-direction: column;">
            <span class="modal-close-btn" onclick="document.getElementById('filter-value-modal').classList.add('hidden')">&times;</span>
            <h3 style="margin-bottom: 15px; color: var(--primary-color);">Pilih Nilai</h3>
            <div style="margin-bottom: 10px;">
                <input type="text" id="popup-search-input" placeholder="Cari di list..." style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px;">
            </div>
            <div style="flex: 1; overflow-y: auto; border: 1px solid #eee; border-radius: 6px;">
                <ul id="filter-value-list" class="search-popup-list"></ul>
            </div>
            <div style="margin-top: 10px; text-align: right;">
                <button class="cancel-btn" onclick="document.getElementById('filter-value-modal').classList.add('hidden')">Tutup</button>
            </div>
        </div>
    </div>

    <div id="pic-selection-modal" class="modal hidden" style="z-index: 3100;">
        <div class="modal-content" style="max-width: 600px; padding: 2rem; border-radius: 12px; display: flex; flex-direction: column; max-height: 85vh;">
            <span class="modal-close-btn" id="close-pic-modal">&times;</span>
            <h3 style="margin-bottom: 10px; color: #C62828;">Pilih PIC SKAI</h3>
            <p style="margin-bottom: 15px; color: #666; font-size: 0.9rem;">Pilih satu atau lebih PIC yang bertanggung jawab.</p>
            
            <div style="margin-bottom: 15px;">
                <input type="text" id="search-pic-input" placeholder="Cari nama PIC..." style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box;">
            </div>

            <div style="flex: 1; overflow-y: auto; border: 1px solid #eee; border-radius: 8px; padding: 0;">
                <table class="pic-table">
                    <thead>
                        <tr>
                            <th style="width: 50px;"><input type="checkbox" id="select-all-pic"></th>
                            <th data-sort-key="name" class="sortable pic-sort">Nama <span class="sort-icon"></span></th>
                            <th data-sort-key="label" class="sortable pic-sort">Label <span class="sort-icon"></span></th>
                        </tr>
                    </thead>
                    <tbody id="pic-list-body">
                    </tbody>
                </table>
            </div>

            <div class="modal-actions" style="margin-top: 20px;">
                <button type="button" class="cancel-btn" id="cancel-pic-btn">Batal</button>
                <button type="button" class="login-btn" id="save-pic-btn" style="background-color: #C62828;">Simpan Pilihan</button>
            </div>
        </div>
    </div>

    <div id="add-data-modal" class="modal hidden" style="z-index: 3005;">
        <div class="modal-content box-layout-modal">
            <span class="modal-close-btn" id="close-data-modal">&times;</span>
            <h3 style="text-align:center; color:#C62828; margin-bottom:20px;">Edit Data Temuan</h3>
            <form id="add-data-form">
                <input type="hidden" id="current-session-id" name="session_id">
                <div class="form-grid-wrapper">
                    <div class="form-group">
                        <label>No AOI:</label>
                        <input type="text" name="no_aoi">
                    </div>
                    
                    <div class="form-group">
                        <label>PIC SKAI:</label>
                        <div class="pic-input-wrapper">
                            <div id="pic-display-area" class="pic-display-box">Belum ada PIC dipilih</div>
                            <input type="hidden" name="pic_skai" id="pic_skai_hidden">
                            <button type="button" id="btn-open-pic-modal" class="btn-pilih-pic">Pilih PIC</button>
                        </div>
                    </div>

                    <div class="form-group"><label>Jenis AOI:</label><input type="text" name="jenis_aoi"></div>
                    <div class="form-group"><label>Klasifikasi:</label><input type="text" name="klasifikasi"></div>
                    <div class="form-group"><label>No LHA:</label><input type="text" name="no_lha"></div>
                    <div class="form-group"><label>Nama Penugasan:</label><input type="text" name="nama_penugasan"></div>
                    <div class="form-group"><label>Area of Improvement (AOI):</label><textarea name="aoi" rows="2"></textarea></div>
                    <div class="form-group"><label>Rekomendasi:</label><textarea name="rekomendasi" rows="2"></textarea></div>
                    <div class="form-group"><label>Rencana Tindak Lanjut:</label><textarea name="rencana_tl" rows="2"></textarea></div>
                    <div class="form-group"><label>Rencana Evidence:</label><textarea name="rencana_evidence" rows="2"></textarea></div>
                    <div class="form-group"><label>PIC Auditee (Gunakan Enter untuk pemisah):</label><textarea name="pic_auditee" rows="4" placeholder="Contoh:&#10;1. Deny Syahbani&#10;2. Renzie Aditya"></textarea></div>
                    <div class="form-group"><label>Auditee:</label><input type="text" name="auditee"></div>
                    <div class="form-group"><label>Target Penyelesaian:</label><input type="date" name="target_penyelesaian"></div>
                    <div class="form-group"><label>Perubahan Target:</label><input type="date" name="perubahan_target"></div>
                    <div class="form-group"><label>Tindak Lanjut:</label><textarea name="tindak_lanjut" rows="2"></textarea></div>
                    <div class="form-group"><label>Signifikansi:</label><input type="text" name="signifikansi"></div>
                    <div class="form-group"><label>Jml Rekomendasi:</label><input type="number" name="jml_rekomendasi" value="0"></div>
                    <div class="form-group"><label>Selesai:</label><input type="number" name="selesai" value="0"></div>
                    <div class="form-group"><label>Belum JT / BS (BPK):</label><input type="number" name="belum_jt_bs" value="0"></div>
                    <div class="form-group"><label>OS / BD (BPK):</label><input type="number" name="os_bd" value="0"></div>
                    <div class="form-group"><label>TDD (BPK):</label><input type="number" name="tdd" value="0"></div>
                    <div class="form-group"><label>Control:</label><input type="text" name="control"></div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="cancel-btn" id="cancel-data-btn">Batal</button>
                    <button type="submit" class="login-btn">Simpan Data</button>
                </div>
            </form>
        </div>
    </div>

    <div id="share-session-modal" class="modal hidden" style="z-index: 2100;">
        <div class="modal-content" style="max-width: 600px; padding: 2rem;">
            <span class="modal-close-btn" id="close-share-modal">&times;</span>
            <h3 style="color: #C62828; margin-bottom: 20px;">Share Sesi Temuan: <span id="share-session-name-display"></span></h3>
            <div id="user-list-container" style="max-height: 400px; overflow-y: auto; border: 1px solid #ddd; border-radius: 8px;">
                <table class="user-share-table">
                    <thead>
                        <tr>
                            <th style="width: 50px;"><input type="checkbox" id="select-all-users"></th>
                            <th data-sort-key="name" class="sortable">Nama <span class="sort-icon"></span></th>
                            <th data-sort-key="label" class="sortable">Label <span class="sort-icon"></span></th>
                        </tr>
                    </thead>
                    <tbody id="user-table-body"></tbody>
                </table>
            </div>
            <button type="button" class="login-btn" id="btn-submit-share" style="width: 100%; margin-top: 25px; padding: 12px;">Share Akses</button>
        </div>
    </div>

    <div id="create-temuan-modal" class="modal hidden">
        <div class="modal-content" style="max-width: 450px; padding: 25px; border-radius: 12px; background: white;">
            <span class="modal-close-btn" id="close-create-modal" style="position: absolute; top: 15px; right: 20px; font-size: 1.5rem; cursor: pointer;">&times;</span>
            <h3 style="margin: 0 0 20px 0; color: #C62828; text-align: center; font-size: 1.4rem; font-weight: 700;">Buat Sesi Temuan Baru</h3>
            <form id="create-temuan-form">
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <div class="form-group" style="margin: 0;">
                        <label style="display: block; margin-bottom: 0px; font-weight: 600; color: #333; font-size: 0.9rem;">Jenis Audit:</label>
                        <select name="jenis_audit" required style="width: 100%; height: 45px; padding: 0 12px; border: 1px solid #ccc; border-radius: 8px; font-size: 0.95rem; background-color: #fff; outline: none; cursor: pointer;">
                            <option value="" disabled selected>-- Pilih Jenis --</option>
                            <option value="Audit Internal">Audit Internal</option>
                            <option value="Audit Dengan Tujuan Tertentu">Audit Dengan Tujuan Tertentu</option>
                            <option value="Audit Investigasi">Audit Investigasi</option>
                            <option value="Review Internal">Review Internal</option>
                            <option value="Assessment Internal">Assessment Internal</option>
                            <option value="Audit Eksternal">Audit Eksternal</option>
                            <option value="Review Eksternal">Review Eksternal</option>
                            <option value="Assessment Eksternal">Assessment Eksternal</option>
                            <option value="Advisory">Advisory</option>
                        </select>
                    </div>
                    <div class="form-group" style="margin: 0;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333; font-size: 0.9rem;">Nama Sesi / Penugasan:</label>
                        <input type="text" name="session_name" required placeholder="Contoh: Audit Cabang X 2024" style="width: 100%; height: 45px; padding: 0 12px; border: 1px solid #ccc; border-radius: 8px; font-size: 0.95rem; outline: none; box-sizing: border-box;">
                    </div>
                </div>
                <div style="margin-top: 15px; padding-top: 0px; border-top: 1px solid #eee;">
                    <button type="submit" class="login-btn" style="width: 100%; padding: 12px; font-size: 1rem; font-weight: 600; border-radius: 8px; background-color: #C62828; color: white; border: none; cursor: pointer; transition: background 0.3s;">Buat</button>
                </div>
            </form>
        </div>
    </div>

    <div id="sheet-selection-modal" class="modal hidden">
        <div class="modal-content" style="max-width: 400px; padding: 2rem; border-radius: 12px; text-align: center;">
            <span class="modal-close-btn" id="close-sheet-modal">&times;</span>
            <h3 style="color: #333; margin-bottom: 10px;">Pilih Sheet Excel</h3>
            <p style="margin-bottom: 20px; color: #666;">Pilih sheet yang berisi data temuan:</p>
            <div class="form-group" style="width: 100%;">
                <select id="excel-sheet-select" style="width: 100%; max-width: 100%; display: block; box-sizing: border-box; padding: 0 35px 0 12px; border-radius: 8px; border: 1px solid #ccc; font-size: 1rem; height: 42px;"></select>
            </div>
            <div class="modal-actions" style="margin-top: 25px; display: flex; justify-content: center; gap: 10px;">
                <button type="button" class="btn-secondary" id="cancel-sheet-btn" style="padding: 10px 20px; border: 1px solid #ccc; background: #fff; color: #333; border-radius: 6px;">Batal</button>
                <button type="button" class="login-btn" id="process-import-btn" style="padding: 10px 20px;">Proses Data</button>
            </div>
        </div>
    </div>

    <div id="import-progress-modal" class="modal hidden" style="z-index: 2000; position: fixed; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4);">
        <div class="modal-content" style="background-color: #fefefe; margin: 15% auto; padding: 30px; border: 1px solid #888; width: 80%; max-width: 400px; text-align: center; border-radius: 12px;">
            <h3 style="margin-top: 0; color: var(--primary-color);">Sedang Mengimpor Data</h3>
            <p style="margin-bottom: 20px;">Mohon tunggu sebentar...</p>
            <div class="progress-container" style="width: 100%; background-color: #f1f1f1; border-radius: 8px; margin: 15px 0; overflow: hidden; height: 30px;">
                <div id="import-progress-bar" style="width: 0%; height: 100%; background-color: #4CAF50; text-align: center; line-height: 30px; color: white; font-weight: bold; transition: width 0.3s;">0%</div>
            </div>
            <p id="import-progress-text" style="font-size: 0.9em; color: #666; margin-top: 10px;">Memulai...</p>
        </div>
    </div>

    <div id="comment-modal" class="modal hidden" style="z-index: 2002;">
        <div class="modal-content" style="max-width: 500px; padding: 2rem; border-radius: 12px;">
            <span class="modal-close-btn" id="close-comment-modal">&times;</span>
            <h3 style="margin-bottom: 15px; color: var(--primary-color);">Tambahkan Komentar</h3>
            <form id="comment-form">
                <div class="form-group full-width">
                    <label style="display: block; margin-bottom: 5px; font-weight: 600;">Isi Komentar:</label>
                    <textarea name="comment_text" id="comment-text-input" rows="5" required placeholder="Tulis catatan Anda di sini..." style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-family: inherit;"></textarea>
                </div>
                <div class="modal-actions" style="margin-top: 20px; display: flex; justify-content: flex-end; gap: 10px;">
                    <button type="button" class="cancel-btn" onclick="document.getElementById('comment-modal').classList.add('hidden')" style="background: #fff; border: 1px solid #ccc; padding: 8px 20px; border-radius: 6px;">Batal</button>
                    <button type="submit" class="login-btn" style="padding: 8px 20px;">Simpan Komentar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="delete-confirm-modal" class="modal hidden" style="z-index: 2001;">
        <div class="modal-content" style="max-width: 400px; text-align: center; border-radius: 12px; padding: 30px;">
            <div style="font-size: 50px; color: #d32f2f; margin-bottom: 15px;">&#9888;</div>
            <h3 style="margin-bottom: 10px; color: #333;">Konfirmasi Hapus</h3>
            <p style="color: #666; margin-bottom: 25px;">Apakah Anda yakin ingin menghapus baris data ini? Tindakan ini tidak dapat dibatalkan.</p>
            <div class="modal-actions" style="justify-content: center; gap: 15px;">
                <button id="btn-confirm-cancel" class="cancel-btn" style="padding: 10px 20px; background: #fff; border: 1px solid #ccc; border-radius: 6px;">Batal</button>
                <button id="btn-confirm-delete" class="login-btn" style="background-color: #d32f2f; padding: 10px 20px; color: white; border: none; border-radius: 6px;">Ya, Hapus</button>
            </div>
        </div>
    </div>

    <div id="delete-comment-modal" class="modal hidden" style="z-index: 2005;">
        <div class="modal-content" style="max-width: 350px; text-align: center; border-radius: 12px; padding: 25px;">
            <div style="font-size: 40px; color: #e57373; margin-bottom: 10px;">&times;</div>
            <h4 style="margin-top: 0; color: #333;">Hapus Catatan?</h4>
            <p style="color: #666; font-size: 0.9rem; margin-bottom: 20px;">Tindakan ini tidak dapat dibatalkan.</p>
            <div class="modal-actions" style="justify-content: center; gap: 10px;">
                <button id="btn-cancel-delete-comment" class="cancel-btn" style="padding: 8px 16px; font-size: 0.9rem; background: #fff; border: 1px solid #ccc; border-radius: 6px;">Batal</button>
                <button id="btn-confirm-delete-comment" class="login-btn" style="background-color: #d32f2f; padding: 8px 16px; font-size: 0.9rem; color: white; border: none; border-radius: 6px;">Hapus</button>
            </div>
        </div>
    </div>

    <div id="custom-message-modal" class="modal hidden" style="z-index: 9999;">
        <div class="modal-content" style="max-width: 400px; text-align: center; padding: 30px; border-radius: 12px;">
            <div style="font-size: 50px; color: #FF9800; margin-bottom: 15px;">&#9888;</div>
            <h3 style="margin: 0 0 10px; color: #333;">Informasi</h3>
            <p id="custom-message-text" style="font-size: 1rem; color: #555; margin-bottom: 25px; line-height: 1.5;"></p>
            <button onclick="document.getElementById('custom-message-modal').classList.add('hidden')" class="login-btn" style="width: 100%; justify-content: center;">Mengerti</button>
        </div>
    </div>

    <div id="import-warning-modal" class="modal hidden" style="z-index: 2005;">
        <div class="modal-content" style="max-width: 450px; text-align: center; border-radius: 12px; padding: 30px;">
            <div style="font-size: 50px; margin-bottom: 10px;"></div>
            <h3 style="margin-top: 0; color: #ff9800; margin-bottom: 10px;">Import Berhasil</h3>
            <p style="color: #333; font-weight: bold; margin-bottom: 15px;">MOHON PERHATIAN:</p>
            <p style="color: #555; font-size: 0.95rem; line-height: 1.6; margin-bottom: 15px;">
                Harap periksa kembali angka pada kolom:<br>
                <strong style="color: #d32f2f;">Selesai, Belum JT / BS, OS / BD, TDD, dan Control.</strong>
            </p>
            <p style="color: #666; font-size: 0.85rem; font-style: italic; background: #fff3e0; padding: 10px; border-radius: 6px; margin-bottom: 25px;">
                "Sistem dapat membuat kesalahan dalam membaca rumus/format Excel. Pastikan data sesuai."
            </p>
            <button id="btn-close-warning" class="login-btn" style="width: 100%; padding: 12px; background-color: #ff9800; color: white; border: none; font-weight: bold;">Saya Mengerti, Saya Akan Cek</button>
        </div>
    </div>

    <div id="report-selection-modal" class="modal hidden" style="z-index: 2200;">
        <div class="modal-content" style="max-width: 500px; padding: 2rem; border-radius: 12px; display: flex; flex-direction: column; max-height: 80vh;">
            <span class="modal-close-btn" id="close-report-modal">&times;</span>
            <h3 style="margin-bottom: 10px; color: var(--primary-color);">Pilih Unit Kerja</h3>
            <p style="margin-bottom: 20px; color: #666; font-size: 0.9rem;">Pilih auditee yang ingin disertakan dalam laporan bulanan.</p>
            <div style="margin-bottom: 15px;">
                <input type="text" id="search-auditee-report" placeholder="Cari unit kerja..." style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box;">
            </div>
            <div style="flex: 1; overflow-y: auto; border: 1px solid #eee; border-radius: 8px; padding: 0;">
                <div style="padding: 10px; border-bottom: 1px solid #eee; background: #f9f9f9; position: sticky; top: 0;">
                    <label style="font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" id="select-all-auditees"> Pilih Semua
                    </label>
                </div>
                <ul id="report-auditee-list" class="search-popup-list" style="border: none; max-height: none;"></ul>
            </div>
            <div class="modal-actions" style="margin-top: 20px;">
                <button type="button" class="cancel-btn" id="cancel-report-btn">Batal</button>
                <button type="button" class="login-btn" id="generate-report-btn" style="background-color: #d32f2f;">Generate Laporan</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script src="{{ url_for('static', filename='ams_temuan.js') }}?v=13"></script>
    
    <script>
        function openSessionInNewPage() {
            let sessionId = null;
            if (typeof currentSessionId !== 'undefined' && currentSessionId) {
                sessionId = currentSessionId;
            } else {
                const savedId = localStorage.getItem('ams_active_temuan_id');
                if (savedId) sessionId = savedId;
            }

            if (!sessionId) {
                if (typeof showCustomMessage === "function") {
                    showCustomMessage("Silakan pilih sesi terlebih dahulu.");
                } else {
                    alert("Silakan pilih sesi terlebih dahulu.");
                }
                return;
            }
            const url = `/view_session_full/${sessionId}`;
            window.open(url, '_blank');
        }
        
        document.addEventListener('DOMContentLoaded', async () => {
        });
    </script>
</body>
</html>